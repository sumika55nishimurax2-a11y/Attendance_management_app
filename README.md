# 模擬案件　\_勤怠管理アプリ

## 環境構築

### Docker ビルド

1.イメージをビルドする。

    docker-compose up -d --build

### Laravel 環境構築

1.docker コンテナに接続する。

    docker-compose exec php bash

2.必要なパッケージをインストールする。

    composer install

3.プロジェクトのルート（/var/www/）で以下のコマンドを使い、『.env.example』をコピー名前変更し『.env』を作成。

      cp .env.example .env

『.env』ファイルの　 11 行目あたりと 31 行目あたりを以下のように編集。

            / 前略
            DB_CONNECTION=mysql
            DB_HOST=mysql
            DB_PORT=3306
            DB_DATABASE=laravel_db
            DB_USERNAME=laravel_user
            DB_PASSWORD=laravel_pass

            // 略

            MAIL_MAILER=smtp
            MAIL_HOST=mailhog
            MAIL_PORT=1025
            MAIL_USERNAME=null
            MAIL_PASSWORD=null
            MAIL_ENCRYPTION=null
            MAIL_FROM_ADDRESS="hello@example.com"
            MAIL_FROM_NAME="勤怠管理"

            // 後略

5.アプリキーを作成

    php artisan key:generate

6.マイグレーション実行

    php artisan migrate

7.シーディング実行

    php artisan db:seed

## 使用技術（実行環境）

- PHP8.2.29

- Laravel10.48.29

- MySQL8.0.26

## 使用技術（メール認証）

- MailHog

## ER 図

<img width="781" height="591" alt="attendanceappER" src="https://github.com/user-attachments/assets/c3e38e29-071a-4cb5-af34-708549a869c6" />

## URL

- 開発環境： http://localhost/

  - 一般機能アクセス: http://localhost/

  - 管理機能アクセス: http://localhost/admin/login

- phpMyAdmin：http://localhost:8080/

- MailHog: http://localhost:8025/

## そのほか

- メール認証は、上記の URL MailHog にアクセスしてメールを確認してください。

- 一般ユーザーログイン用ダミーデータ

  パスワードは共通で作成しています。

  - password:password

  - ユーザー１

    name:佐藤太郎

    email:taro.sato@example.com

  - ユーザー２

    name:鈴木花子

    email:hanako.suzuki@example.com

  - ユーザー３

    name:田中一郎

    email:ichiro.tanaka@example.com

- 管理機能アクセス用管理者ダミーデータ

  ＊この管理者情報では一般機能にはログインはできません。

  name:山田太一(管理者)

  email:admin@example.com

  password:admin123

  ***

# 単体テストについて

## 単体テスト（PHPUnit）実行コマンド

Docker コンテナに接続する

-      docker-compose exec php bash

テストを実行する

-      php artisan test

---

## ログイン認証機能

| テストファイル     | 機能概要                                                                                                   |
| ------------------ | ---------------------------------------------------------------------------------------------------------- |
| **UserLoginTest**  | 一般ユーザーの会員登録・ログイン処理を確認。未入力・桁数不足・不一致などのバリデーションメッセージを検証。 |
| **AdminLoginTest** | 管理者ログイン処理を確認。メール・パスワード未入力時のバリデーション、認証失敗時のメッセージ表示を検証。   |

---

## 日時取得・ステータス確認機能

| テストファイル      | 機能概要                                                                                                              |
| ------------------- | --------------------------------------------------------------------------------------------------------------------- |
| **CheckStatusTest** | 勤怠状況（出勤前／出勤中／休憩中／退勤済）を正しく判定できるかを検証。<br>UI 上の日付やステータス表示の整合性も確認。 |

---

## 出勤・休憩・退勤機能

| テストファイル   | 機能概要                                                                                                                  |
| ---------------- | ------------------------------------------------------------------------------------------------------------------------- |
| **ClockInTest**  | 出勤ボタン押下時の動作を検証。<br>1 日 1 回のみ出勤できる制御と、打刻時刻の UI 表示を確認。                               |
| **BreakTest**    | 休憩開始／休憩戻り処理を検証。<br>休憩ボタンと「休憩戻」ボタンの切り替え、およびステータス遷移（出勤中 ↔ 休憩中）を確認。 |
| **ClockOutTest** | 退勤ボタン押下時の動作を検証。<br>退勤処理後のボタン非表示とステータス「退勤済」への切り替えを確認。                      |

---

## 勤怠一覧・詳細（一般ユーザー）

| テストファイル               | 機能概要                                                                                                           |
| ---------------------------- | ------------------------------------------------------------------------------------------------------------------ |
| **UserAttendanceListTest**   | 一般ユーザーが自分の月次勤怠一覧を確認できるか検証。<br>月移動ボタン（前月／翌月）と詳細ページリンクの動作も確認。 |
| **UserAttendanceDetailTest** | 勤怠詳細画面に正しい日付・時刻・休憩時間が表示されるか検証。                                                       |

---

## 勤怠修正申請（一般ユーザー）

| テストファイル                | 機能概要                                                                                                   |
| ----------------------------- | ---------------------------------------------------------------------------------------------------------- |
| **UserCorrectionRequestTest** | 出退勤修正申請処理を検証。<br>理由未入力・時刻逆転などのバリデーションと、修正申請の保存・差分確認を実施。 |

---

## 勤怠一覧・詳細（管理者）

| テストファイル                | 機能概要                                                                                                                       |
| ----------------------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| **AdminAttendanceListTest**   | 管理者が全ユーザーの勤怠を日別で一覧確認できるかを検証。<br>前日／翌日ボタンによる日付切り替えも確認。                         |
| **AdminAttendanceDetailTest** | 管理者が個別の勤怠詳細を表示・修正できるかを検証。<br>時刻の不整合、休憩時間の不正、修正理由未入力時のエラーメッセージを確認。 |

---

## 修正申請承認（管理者）

| テストファイル                  | 機能概要                                                                                             |
| ------------------------------- | ---------------------------------------------------------------------------------------------------- |
| **AdminCorrectionApprovalTest** | 修正申請一覧・詳細・承認処理を検証。<br>承認待ち／承認済みリストの切り替え、勤怠データの反映を確認。 |

---

## ユーザー管理（管理者）

| テストファイル        | 機能概要                                                                                       |
| --------------------- | ---------------------------------------------------------------------------------------------- |
| **AdminUserInfoTest** | 管理者による全ユーザーの勤怠情報参照機能を検証。<br>前月／翌月ナビゲーションと詳細遷移を確認。 |

---

## 応用機能：メール認証

| テストファイル            | 機能概要                                                                                                   |
| ------------------------- | ---------------------------------------------------------------------------------------------------------- |
| **EmailVerificationTest** | ユーザー登録後に送信されるメール認証処理を検証。<br>認証メール送信・リンククリック後の遷移・再送信を確認。 |

---

## まとめ

- 案件シートのすべての機能に対して、**該当する単体テストファイルが対応**。
- 各テストで UI 状態、データ整合性、バリデーション文言の一致を確認済み。
- すべてのテストは `php artisan test` で **全件 PASS** を確認済み。
